version: '1.0'
steps:

  build-step:
    description: Building the image.
    title: The build step
    type: build
    dockerfile: Dockerfile
    image-name: advance512demo/demochat
    tag: codefresh
    when:
      branch:
        only:
          - /.*conditional.*/
  
  another-step:
    title: Another step!
    description: Another step.
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '"${{CF_BRANCH}}" == "conditional_step2"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "conditional") == 0'
    
  yet-another-freestyle-step:
    title: Yet another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        any:
          branchCheck1: '"${{CF_BRANCH}}" == "not_conditional"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "con") == 0'

  incredibly-another-freestyle-step:
    title: Incredibly another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/ ]

  on-no-another-freestyle-step:
    description: Oh no, another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/i ]
        
  last-freestyle-step:
    description: Last freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        only:
          [ conditional_step2 ]
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/i ]
          
          
  laster-freestyle-step:
    title: Laster  freestyle step... wtf?
    description: Laster freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '"${{CF_BRANCH}}" == "not_a_conditional_step"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "conditional") == 0'
        any:
          branchCheck1: '"${{CF_BRANCH}}" == "conditional_step2"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "conditional") == 0'

        
  lastest-freestyle-step:
    description: Lastest freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '"${{CF_BRANCH}}" != "not_a_conditional_step"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "conditional") == 0'
        any:
          branchCheck1: '"${{CF_BRANCH}}" != "conditional_step2"'
          branchCheck2: 'indexOf(Variable("initial_clone").branch, "not_really") != 0'
