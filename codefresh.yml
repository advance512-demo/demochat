version: '1.0'
steps:

  build-step:
    description: Building the image.
    type: build
    dockerfile: Dockerfile
    image-name: advance512demo/demochat
    tag: codefresh
    when:
      branch:
        only:
          - /.*conditional.*/
  
  another-step:
    description: Another step.
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '${{CF_BRANCH}} == "conditional_step2'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "conditional")'
    
  yet-another-freestyle-step:
    description: Yet another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        any:
          branchCheck1: '${{CF_BRANCH}} == "not_conditional'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "con")'

  incredibly-another-freestyle-step:
    description: Incredibly another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/ ]

  on-no-another-freestyle-step:
    description: Oh no, another freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/i ]
        
  last-freestyle-step:
    description: Last freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      branch:
        only:
          [ conditional_step2 ]
        ignore:
          [ bad_branch, /another_bad.*/, /CONDITION/i ]
          
          
  laster-freestyle-step:
    description: Laster freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '${{CF_BRANCH}} == "not_a_conditional_step'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "conditional")'
        any:
          branchCheck1: '${{CF_BRANCH}} == "conditional_step2'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "conditional")'

        
  lastest-freestyle-step:
    description: Lastest freestyle step
    image: ${{build-step}}
    commands:
      - echo $(date)
    when:
      condition:
        all:
          branchCheck1: '${{CF_BRANCH}} != "not_a_conditional_step'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "conditional")'
        any:
          branchCheck1: '${{CF_BRANCH}} != "conditional_step2'
          branchCheck2: 'startsWith(Variable("initial-clone").branch, "not_really")'
